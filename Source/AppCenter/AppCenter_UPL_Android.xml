<?xml version="1.0" encoding="utf-8"?>
<!-- AppCenter plugin additions-->
<root xmlns:android="http://schemas.android.com/apk/res/android">
  <init>
    <log text="AppCenter Android Initialization"/>
    <setBoolFromProperty result="bEnableAnalytics" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="bEnableAnalytics" default="false"/>
    <setBoolFromProperty result="bEnableCrashes" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="bEnableCrashes" default="false"/>
    <setBoolFromProperty result="bEnableDistribute" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="bEnableDistribute" default="false"/>
    <setBoolFromProperty result="bEnablePush" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="bEnablePush" default="false"/>
    <setStringFromProperty result="AppSecret" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="AppSecret" default=""/>
    <setStringFromProperty result="SdkVersion" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="SdkVersion" default="1.11.4"/>
    <setBoolFromProperty result="bDebug" ini="Engine" section="/Script/AppCenter.AppCenterSettings" property="bDebug" default="true"/>
  </init>

  <androidManifestUpdates>
  </androidManifestUpdates>

  <proguardAdditions>
  </proguardAdditions>

  <buildGradleAdditions>
    <if condition="bEnableAnalytics">
      <true>
        <insert>
          dependencies {
            def appCenterSdkVersion = '</insert><insertValue value="$S(SdkVersion)" /><insert>'
            implementation "com.microsoft.appcenter:appcenter-analytics:${appCenterSdkVersion}"
          }
        </insert>
      </true>
    </if>
    <if condition="bEnableCrashes">
      <true>
        <insert>
          dependencies {
            def appCenterSdkVersion = '</insert><insertValue value="$S(SdkVersion)" /><insert>'
            implementation "com.microsoft.appcenter:appcenter-crashes:${appCenterSdkVersion}"
          }
        </insert>
      </true>
    </if>
    <if condition="bEnableDistribute">
      <true>
        <insert>
          dependencies {
            def appCenterSdkVersion = '</insert><insertValue value="$S(SdkVersion)" /><insert>'
            implementation "com.microsoft.appcenter:appcenter-distribute:${appCenterSdkVersion}"
          }
        </insert>
      </true>
    </if>
    <if condition="bEnablePush">
      <true>
        <insert>
          dependencies {
            def appCenterSdkVersion = '</insert><insertValue value="$S(SdkVersion)" /><insert>'
            implementation "com.microsoft.appcenter:appcenter-push:${appCenterSdkVersion}"
          }
        </insert>
      </true>
    </if>
  </buildGradleAdditions>

  <gameActivityImportAdditions>
    <if condition="bEnableAnalytics">
      <true>
        <insert>
          import com.microsoft.appcenter.AppCenter;
          import com.microsoft.appcenter.analytics.Analytics;
        </insert>
      </true>
    </if>
    <if condition="bEnableCrashes">
      <true>
        <insert>
          import android.os.Environment;
          import com.microsoft.appcenter.AppCenter;
          import com.microsoft.appcenter.crashes.Crashes;
          import com.microsoft.appcenter.utils.async.AppCenterConsumer;
        </insert>
      </true>
    </if>
    <if condition="bEnableDistribute">
      <true>
        <insert>
          import com.microsoft.appcenter.AppCenter;
          import com.microsoft.appcenter.distribute.Distribute;
        </insert>
      </true>
    </if>
    <if condition="bEnablePush">
      <true>
        <insert>
          import com.microsoft.appcenter.AppCenter;
          import com.microsoft.appcenter.push.Push;
        </insert>
      </true>
    </if>
  </gameActivityImportAdditions>

  <gameActivityClassAdditions>
    <if condition="bEnableCrashes">
      <true>
        <insert>
          native void setUpBreakpad(String path);
          
          public void AndroidThunkJava_TestCrash()
          {
            Crashes.generateTestCrash();
          }
        </insert>
      </true>
    </if>
  </gameActivityClassAdditions>

  <gameActivityOnCreateAdditions>
    <if condition="bDebug">
      <true>
        <insert>
          AppCenter.setLogLevel(2);
        </insert>
      </true>
    </if>
    <if condition="bEnableAnalytics">
      <true>
        <insert>
          AppCenter.start(getApplication(), </insert><insertValue value="&quot;$S(AppSecret)&quot;" /><insert>, Analytics.class, Crashes.class);
        </insert>
      </true>
    </if>
    <if condition="bEnableCrashes">
      <true>
        <insert>
          Crashes.getMinidumpDirectory().thenAccept(new AppCenterConsumer&lt;String&gt;() {

            @Override
            public void accept(String path) {

              /* Path is null when Crashes is disabled */
              if (path != null) {
                setUpBreakpad(path);
              }
            }
          });
 
          // AppCenter.start(getApplication(), </insert><insertValue value="&quot;$S(AppSecret)&quot;" /><insert>, Crashes.class);
        </insert>
      </true>
    </if>
    <if condition="bEnableDistribute">
      <true>
        <insert>
          //AppCenter.start(getApplication(), </insert><insertValue value="&quot;$S(AppSecret)&quot;" /><insert>, Distribute.class);
        </insert>
      </true>
    </if>
    <if condition="bEnablePush">
      <true>
        <insert>
          //AppCenter.start(getApplication(), </insert><insertValue value="&quot;$S(AppSecret)&quot;" /><insert>, Push.class);
        </insert>
      </true>
    </if>
  </gameActivityOnCreateAdditions>

</root>
